colnames(parV2) <- c("Participant_ID","sample","Visit")
parV3 <- parV3[,c("Participant_ID","PART_SAMPLE_TIME")]
parV3$Visit <- "V3"
colnames(parV3) <- c("Participant_ID","sample","Visit")
parV4A <- parV4[,c("Participant_ID","PART_BIRTH_YEAR","PART_BIRTH_MONTH")]
parV4B <- parV4[,c("Participant_ID","PART_SAMPLE_TIME")]
parV4B$Visit <- "V4"
colnames(parV4B) <- c("Participant_ID","sample","Visit")
dat <- merge(dat,parV4A,by="Participant_ID")
dat$birth_date <- paste0(dat$PART_BIRTH_YEAR,"-",dat$PART_BIRTH_MONTH,"-01")
dat$birth_date <- as.Date(dat$birth_date)
head(dat)
dat <- merge(dat,parV1,by=c("Participant_ID","Visit"),all = TRUE)
head(dat)
dat1 <- merge(dat,parV2,by=c("Participant_ID","Visit"))
head(dat1)
dat1 <- merge(dat,parV2,by=c("Participant_ID","Visit"),all.x=TRUE)
head(dat1)
dat1 <- merge(dat,parV2,by=c("Participant_ID","Visit"),all.y=TRUE)
head(dat1)
datV1 <- merge(dat[dat$Visit=="V1"],parV1,by=c("Participant_ID","Visit"),all = TRUE)
head(dat)
datV1 <- merge(dat[dat$Visit=="V1",],parV1,by=c("Participant_ID","Visit"),all = TRUE)
datV3 <- merge(dat[dat$Visit=="V3",],parV3,by=c("Participant_ID","Visit"),all = TRUE)
datV4 <- merge(dat[dat$Visit=="V4",],parV4B,by=c("Participant_ID","Visit"),all = TRUE)
colnames(viruses)[1] <- "Virus"
head(datV1)
dat <- read.csv("~/Documents/Fluscape/fluscape/trunk/data/HI_titers_paired.csv")
viruses <- read.csv("~/Documents/Fluscape/FluScapeOwn/H3N2_codes.csv")
parV4 <- read.csv("~/Documents/Fluscape/fluscape/trunk/data/Participants_V4.csv")
parV1 <- read.csv("~/Documents/Fluscape/fluscape/trunk/data/Participants_V1.csv")
parV2 <- read.csv("~/Documents/Fluscape/fluscape/trunk/data/Participants_V2.csv")
parV3 <- read.csv("~/Documents/Fluscape/fluscape/trunk/data/Participants_V3.csv")
parV4$Participant_ID <- apply(parV4[,1:3],1,
function(x){
sprintf("L%02dH%02dP%02d",as.numeric(x[3]),as.numeric(x[2]),as.numeric(x[1]))
})
parV1$Participant_ID <- apply(parV1[,1:3],1,
function(x){
sprintf("L%02dH%02dP%02d",as.numeric(x[3]),as.numeric(x[2]),as.numeric(x[1]))
})
parV2$Participant_ID <- apply(parV2[,1:3],1,
function(x){
sprintf("L%02dH%02dP%02d",as.numeric(x[3]),as.numeric(x[2]),as.numeric(x[1]))
})
parV3$Participant_ID <- apply(parV3[,1:3],1,
function(x){
sprintf("L%02dH%02dP%02d",as.numeric(x[3]),as.numeric(x[2]),as.numeric(x[1]))
})
parV1 <- parV1[,c("Participant_ID","PART_SAMPLE_TIME")]
parV1$Visit <- "V1"
colnames(parV1) <- c("Participant_ID","sample","Visit")
parV2 <- parV2[,c("Participant_ID","PART_SAMPLE_TIME")]
parV2$Visit <- "V2"
colnames(parV2) <- c("Participant_ID","sample","Visit")
parV3 <- parV3[,c("Participant_ID","PART_SAMPLE_TIME")]
parV3$Visit <- "V3"
colnames(parV3) <- c("Participant_ID","sample","Visit")
parV4A <- parV4[,c("Participant_ID","PART_BIRTH_YEAR","PART_BIRTH_MONTH")]
parV4B <- parV4[,c("Participant_ID","PART_SAMPLE_TIME")]
parV4B$Visit <- "V4"
colnames(parV4B) <- c("Participant_ID","sample","Visit")
dat <- merge(dat,parV4A,by="Participant_ID")
dat$birth_date <- paste0(dat$PART_BIRTH_YEAR,"-",dat$PART_BIRTH_MONTH,"-01")
dat$birth_date <- as.Date(dat$birth_date)
datV1 <- merge(dat[dat$Visit=="V1",],parV1,by=c("Participant_ID","Visit"),all = TRUE)
datV2 <- merge(dat[dat$Visit=="V2",],parV2,by=c("Participant_ID","Visit"),all=TRUE)
datV3 <- merge(dat[dat$Visit=="V3",],parV3,by=c("Participant_ID","Visit"),all = TRUE)
datV4 <- merge(dat[dat$Visit=="V4",],parV4B,by=c("Participant_ID","Visit"),all = TRUE)
dat <- rbind(datV1,datV2,datV3,datV4)
head(dat)
dat <- dat[,c("Participant_ID","Visit","Virus","HI_Titer","birth_date","sample")]
head(dat)
dat$sample <- as.Date(dat$sample)
head(dat)
hist(dat$birth_date)
hist(dat$sample)
ggplot(dat) + geom_histogram(aes(x=sample))
ggplot(dat) + geom_histogram(aes(x=birth_date))
ggplot(unique(dat[,c("Participant_ID","birth_date")])) + geom_histogram(aes(x=birth_date))
tmp <- dat[dat$Participant_ID=="L01H01P01",]
tmp
ggplot(tmp) + geom_point(aes(x=sample,y=HI_titer)) + facet_wrap(~Virus)
ggplot(tmp) + geom_point(aes(x=sample,y=HI_Titer)) + facet_wrap(~Virus)
ggplot(dat[dat$Participant_ID=="L01H01P01",]) + geom_point(aes(x=sample,y=HI_titer)) + facet_wrap(~Virus)
ggplot(dat[dat$Participant_ID=="L01H01P01",]) + geom_point(aes(x=sample,y=HI_Titer)) + facet_wrap(~Virus)
ggplot(dat[dat$Participant_ID==unique(dat$Participant_ID)[2],]) + geom_point(aes(x=sample,y=HI_Titer)) + facet_wrap(~Virus)
ggplot(dat[dat$Participant_ID==unique(dat$Participant_ID)[2],]) + geom_line(aes(x=sample,y=HI_Titer)) + facet_wrap(~Virus)
levels(dat$Virus)
head(viruses)
unique(viruses[,c("year","no_duplicated_codes")])
real_order <- order(tmpViruses$year)
tmpViruses <- unique(viruses[,c("year","no_duplicated_codes")])
real_order <- order(tmpViruses$year)
real_order
dat$Virus <- factor(dat$Virus, levels(dat$Virus)[real_order])
ggplot(dat[dat$Participant_ID==unique(dat$Participant_ID)[2],]) + geom_line(aes(x=sample,y=HI_Titer)) + facet_wrap(~Virus)
levels(dat$Virus)
dat <- read.csv("~/Documents/Fluscape/fluscape/trunk/data/HI_titers_paired.csv")
viruses <- read.csv("~/Documents/Fluscape/FluScapeOwn/H3N2_codes.csv")
## Reorder viruses with what is there
tmpViruses <- unique(viruses[,c("year","no_duplicated_codes")])
real_order <- order(tmpViruses$year)
parV4 <- read.csv("~/Documents/Fluscape/fluscape/trunk/data/Participants_V4.csv")
parV1 <- read.csv("~/Documents/Fluscape/fluscape/trunk/data/Participants_V1.csv")
parV2 <- read.csv("~/Documents/Fluscape/fluscape/trunk/data/Participants_V2.csv")
parV3 <- read.csv("~/Documents/Fluscape/fluscape/trunk/data/Participants_V3.csv")
parV4$Participant_ID <- apply(parV4[,1:3],1,
function(x){
sprintf("L%02dH%02dP%02d",as.numeric(x[3]),as.numeric(x[2]),as.numeric(x[1]))
})
parV1$Participant_ID <- apply(parV1[,1:3],1,
function(x){
sprintf("L%02dH%02dP%02d",as.numeric(x[3]),as.numeric(x[2]),as.numeric(x[1]))
})
parV2$Participant_ID <- apply(parV2[,1:3],1,
function(x){
sprintf("L%02dH%02dP%02d",as.numeric(x[3]),as.numeric(x[2]),as.numeric(x[1]))
})
parV3$Participant_ID <- apply(parV3[,1:3],1,
function(x){
sprintf("L%02dH%02dP%02d",as.numeric(x[3]),as.numeric(x[2]),as.numeric(x[1]))
})
parV1 <- parV1[,c("Participant_ID","PART_SAMPLE_TIME")]
parV1$Visit <- "V1"
colnames(parV1) <- c("Participant_ID","sample","Visit")
parV2 <- parV2[,c("Participant_ID","PART_SAMPLE_TIME")]
parV2$Visit <- "V2"
colnames(parV2) <- c("Participant_ID","sample","Visit")
parV3 <- parV3[,c("Participant_ID","PART_SAMPLE_TIME")]
parV3$Visit <- "V3"
colnames(parV3) <- c("Participant_ID","sample","Visit")
parV4A <- parV4[,c("Participant_ID","PART_BIRTH_YEAR","PART_BIRTH_MONTH")]
parV4B <- parV4[,c("Participant_ID","PART_SAMPLE_TIME")]
parV4B$Visit <- "V4"
colnames(parV4B) <- c("Participant_ID","sample","Visit")
dat <- merge(dat,parV4A,by="Participant_ID")
dat$birth_date <- paste0(dat$PART_BIRTH_YEAR,"-",dat$PART_BIRTH_MONTH,"-01")
dat$birth_date <- as.Date(dat$birth_date)
datV1 <- merge(dat[dat$Visit=="V1",],parV1,by=c("Participant_ID","Visit"),all = TRUE)
datV2 <- merge(dat[dat$Visit=="V2",],parV2,by=c("Participant_ID","Visit"),all=TRUE)
datV3 <- merge(dat[dat$Visit=="V3",],parV3,by=c("Participant_ID","Visit"),all = TRUE)
datV4 <- merge(dat[dat$Visit=="V4",],parV4B,by=c("Participant_ID","Visit"),all = TRUE)
dat <- rbind(datV1,datV2,datV3,datV4)
dat$sample <- as.Date(dat$sample)
dat <- dat[,c("Participant_ID","Visit","Virus","HI_Titer","birth_date","sample")]
levels(dat$Virus)
levels(viruses$no_duplicated_codes)
dat <- read.csv("~/Documents/Fluscape/fluscape/trunk/data/HI_titers_paired.csv")
dat <- read.csv("~/Documents/Fluscape/fluscape/trunk/data/HI_titers_paired.csv")
viruses <- read.csv("~/Documents/Fluscape/FluScapeOwn/H3N2_codes.csv")
tmpViruses <- unique(viruses[,c("year","no_duplicated_codes")])
tmpViruses <- unique(viruses[,c("year","no_duplicated_codes")])
real_order <- order(tmpViruses$year)
dat <- read.csv("~/Documents/Fluscape/fluscape/trunk/data/HI_titers_paired.csv")
viruses <- read.csv("~/Documents/Fluscape/FluScapeOwn/H3N2_codes.csv")
## Reorder viruses with what is there
tmpViruses <- unique(viruses[,c("year","no_duplicated_codes")])
real_order <- order(tmpViruses$year)
colnames(viruses)[1] <- "Virus"
dat <- merge(dat,viruses[,c("Virus","no_duplicated_codes")], by = "Virus")
colnames(dat)[1] <- "OldVirus"
colnames(dat)[15] <- "Virus"
levels(dat$Virus)
levels(viruses$no_duplicated_codes)
real_order
levels(dat$Virus)[real_order]
head(viruses)
viruses <- viruses[viruses$no_duplicated_codes %in% unique(dat$Virus)]
viruses <- viruses[viruses$no_duplicated_codes %in% unique(dat$Virus),]
viruses <- viruses[viruses$no_duplicated_codes %in% unique(dat$Virus),]
tmpViruses <- unique(viruses[,c("year","no_duplicated_codes")])
real_order <- order(tmpViruses$year)
real_order
head(viruses)
levels(dat$Virus)
tmpViruses <- tmpViruses[order(tmpViruses$no_duplicated_codes),]
head(tmpViruses)
real_order <- order(tmpViruses$year)
real_order
levels(dat$Virus) <- factor(dat$Virus,levels(dat$Virus)[real_order])
ggplot(dat[dat$Participant_ID==unique(dat$Participant_ID)[2],]) + geom_line(aes(x=sample,y=HI_Titer)) + facet_wrap(~Virus)
head(dat)
ggplot(dat[dat$Participant_ID==unique(dat$Participant_ID)[2],]) + geom_line(aes(x=sample,y=HI_Titer)) + facet_wrap(~Virus)
dat <- read.csv("~/Documents/Fluscape/fluscape/trunk/data/HI_titers_paired.csv")
viruses <- read.csv("~/Documents/Fluscape/FluScapeOwn/H3N2_codes.csv")
## Reorder viruses with what is there
colnames(viruses)[1] <- "Virus"
dat <- merge(dat,viruses[,c("Virus","no_duplicated_codes")], by = "Virus")
colnames(dat)[1] <- "OldVirus"
colnames(dat)[15] <- "Virus"
viruses <- viruses[viruses$no_duplicated_codes %in% unique(dat$Virus),]
tmpViruses <- unique(viruses[,c("year","no_duplicated_codes")])
tmpViruses <- tmpViruses[order(tmpViruses$no_duplicated_codes),]
real_order <- order(tmpViruses$year)
levels(dat$Virus) <- factor(dat$Virus,levels(dat$Virus)[real_order])
parV4 <- read.csv("~/Documents/Fluscape/fluscape/trunk/data/Participants_V4.csv")
parV1 <- read.csv("~/Documents/Fluscape/fluscape/trunk/data/Participants_V1.csv")
parV2 <- read.csv("~/Documents/Fluscape/fluscape/trunk/data/Participants_V2.csv")
parV3 <- read.csv("~/Documents/Fluscape/fluscape/trunk/data/Participants_V3.csv")
parV4$Participant_ID <- apply(parV4[,1:3],1,
function(x){
sprintf("L%02dH%02dP%02d",as.numeric(x[3]),as.numeric(x[2]),as.numeric(x[1]))
})
parV1$Participant_ID <- apply(parV1[,1:3],1,
function(x){
sprintf("L%02dH%02dP%02d",as.numeric(x[3]),as.numeric(x[2]),as.numeric(x[1]))
})
parV2$Participant_ID <- apply(parV2[,1:3],1,
function(x){
sprintf("L%02dH%02dP%02d",as.numeric(x[3]),as.numeric(x[2]),as.numeric(x[1]))
})
parV3$Participant_ID <- apply(parV3[,1:3],1,
function(x){
sprintf("L%02dH%02dP%02d",as.numeric(x[3]),as.numeric(x[2]),as.numeric(x[1]))
})
parV1 <- parV1[,c("Participant_ID","PART_SAMPLE_TIME")]
parV1$Visit <- "V1"
colnames(parV1) <- c("Participant_ID","sample","Visit")
parV2 <- parV2[,c("Participant_ID","PART_SAMPLE_TIME")]
parV2$Visit <- "V2"
colnames(parV2) <- c("Participant_ID","sample","Visit")
parV3 <- parV3[,c("Participant_ID","PART_SAMPLE_TIME")]
parV3$Visit <- "V3"
colnames(parV3) <- c("Participant_ID","sample","Visit")
parV4A <- parV4[,c("Participant_ID","PART_BIRTH_YEAR","PART_BIRTH_MONTH")]
parV4B <- parV4[,c("Participant_ID","PART_SAMPLE_TIME")]
parV4B$Visit <- "V4"
colnames(parV4B) <- c("Participant_ID","sample","Visit")
dat <- merge(dat,parV4A,by="Participant_ID")
dat$birth_date <- paste0(dat$PART_BIRTH_YEAR,"-",dat$PART_BIRTH_MONTH,"-01")
dat$birth_date <- as.Date(dat$birth_date)
datV1 <- merge(dat[dat$Visit=="V1",],parV1,by=c("Participant_ID","Visit"),all = TRUE)
datV2 <- merge(dat[dat$Visit=="V2",],parV2,by=c("Participant_ID","Visit"),all=TRUE)
datV3 <- merge(dat[dat$Visit=="V3",],parV3,by=c("Participant_ID","Visit"),all = TRUE)
datV4 <- merge(dat[dat$Visit=="V4",],parV4B,by=c("Participant_ID","Visit"),all = TRUE)
dat <- rbind(datV1,datV2,datV3,datV4)
dat$sample <- as.Date(dat$sample)
dat <- dat[,c("Participant_ID","Visit","Virus","HI_Titer","birth_date","sample")]
dat$Virus <- factor(dat$Virus, levels(dat$Virus)[real_order])
####################################
## Do some data cleaning here
dat[dat$Visit == "v1","Visit"] <- "V1"
dat <- dat[dat$Visit != "20",]
dat[dat$HI_Titer == 1,"HI_Titer"] <- 10
head(dat)
ggplot(dat[dat$Participant_ID==unique(dat$Participant_ID)[2],]) + geom_line(aes(x=sample,y=HI_Titer)) + facet_wrap(~Virus)
unique(dat$Virus)
dat <- read.csv("~/Documents/Fluscape/fluscape/trunk/data/HI_titers_paired.csv")
viruses <- read.csv("~/Documents/Fluscape/FluScapeOwn/H3N2_codes.csv")
## Reorder viruses with what is there
colnames(viruses)[1] <- "Virus"
dat <- merge(dat,viruses[,c("Virus","no_duplicated_codes")], by = "Virus")
colnames(dat)[1] <- "OldVirus"
colnames(dat)[15] <- "Virus"
viruses <- viruses[viruses$no_duplicated_codes %in% unique(dat$Virus),]
tmpViruses <- unique(viruses[,c("year","no_duplicated_codes")])
tmpViruses <- tmpViruses[order(tmpViruses$no_duplicated_codes),]
real_order <- order(tmpViruses$year)
levels(dat$Virus) <- factor(dat$Virus,levels(dat$Virus)[real_order])
parV4 <- read.csv("~/Documents/Fluscape/fluscape/trunk/data/Participants_V4.csv")
parV1 <- read.csv("~/Documents/Fluscape/fluscape/trunk/data/Participants_V1.csv")
parV2 <- read.csv("~/Documents/Fluscape/fluscape/trunk/data/Participants_V2.csv")
parV3 <- read.csv("~/Documents/Fluscape/fluscape/trunk/data/Participants_V3.csv")
parV4$Participant_ID <- apply(parV4[,1:3],1,
function(x){
sprintf("L%02dH%02dP%02d",as.numeric(x[3]),as.numeric(x[2]),as.numeric(x[1]))
})
parV1$Participant_ID <- apply(parV1[,1:3],1,
function(x){
sprintf("L%02dH%02dP%02d",as.numeric(x[3]),as.numeric(x[2]),as.numeric(x[1]))
})
parV2$Participant_ID <- apply(parV2[,1:3],1,
function(x){
sprintf("L%02dH%02dP%02d",as.numeric(x[3]),as.numeric(x[2]),as.numeric(x[1]))
})
parV3$Participant_ID <- apply(parV3[,1:3],1,
function(x){
sprintf("L%02dH%02dP%02d",as.numeric(x[3]),as.numeric(x[2]),as.numeric(x[1]))
})
parV1 <- parV1[,c("Participant_ID","PART_SAMPLE_TIME")]
parV1$Visit <- "V1"
colnames(parV1) <- c("Participant_ID","sample","Visit")
parV2 <- parV2[,c("Participant_ID","PART_SAMPLE_TIME")]
parV2$Visit <- "V2"
colnames(parV2) <- c("Participant_ID","sample","Visit")
parV3 <- parV3[,c("Participant_ID","PART_SAMPLE_TIME")]
parV3$Visit <- "V3"
colnames(parV3) <- c("Participant_ID","sample","Visit")
parV4A <- parV4[,c("Participant_ID","PART_BIRTH_YEAR","PART_BIRTH_MONTH")]
parV4B <- parV4[,c("Participant_ID","PART_SAMPLE_TIME")]
parV4B$Visit <- "V4"
colnames(parV4B) <- c("Participant_ID","sample","Visit")
dat <- merge(dat,parV4A,by="Participant_ID")
dat$birth_date <- paste0(dat$PART_BIRTH_YEAR,"-",dat$PART_BIRTH_MONTH,"-01")
dat$birth_date <- as.Date(dat$birth_date)
datV1 <- merge(dat[dat$Visit=="V1",],parV1,by=c("Participant_ID","Visit"),all = TRUE)
datV2 <- merge(dat[dat$Visit=="V2",],parV2,by=c("Participant_ID","Visit"),all=TRUE)
datV3 <- merge(dat[dat$Visit=="V3",],parV3,by=c("Participant_ID","Visit"),all = TRUE)
datV4 <- merge(dat[dat$Visit=="V4",],parV4B,by=c("Participant_ID","Visit"),all = TRUE)
dat <- rbind(datV1,datV2,datV3,datV4)
dat$sample <- as.Date(dat$sample)
dat <- dat[,c("Participant_ID","Visit","Virus","HI_Titer","birth_date","sample")]
unique(dat$Virus)
dat <- read.csv("~/Documents/Fluscape/fluscape/trunk/data/HI_titers_paired.csv")
dat <- read.csv("~/Documents/Fluscape/fluscape/trunk/data/HI_titers_paired.csv")
viruses <- read.csv("~/Documents/Fluscape/FluScapeOwn/H3N2_codes.csv")
viruses <- read.csv("~/Documents/Fluscape/FluScapeOwn/H3N2_codes.csv")
colnames(viruses)[1] <- "Virus"
dat <- merge(dat,viruses[,c("Virus","no_duplicated_codes")], by = "Virus")
head(dat)
colnames(dat)[1] <- "OldVirus"
colnames(dat)[15] <- "Virus"
head(dat)
unique(dat$Virus)
viruses <- viruses[viruses$no_duplicated_codes %in% unique(dat$Virus),]
viruses
tmpViruses <- unique(viruses[,c("year","no_duplicated_codes")])
tmpViruses <- tmpViruses[order(tmpViruses$no_duplicated_codes),]
real_order <- order(tmpViruses$year)
real_order
levels(tmp$Virus)
levels(tmp$Virus)[real_order]
dat$Virus <- factor(dat$Virus,levels(dat$Virus)[real_order])
unique(dat$Virus)
parV4 <- read.csv("~/Documents/Fluscape/fluscape/trunk/data/Participants_V4.csv")
parV1 <- read.csv("~/Documents/Fluscape/fluscape/trunk/data/Participants_V1.csv")
parV2 <- read.csv("~/Documents/Fluscape/fluscape/trunk/data/Participants_V2.csv")
parV3 <- read.csv("~/Documents/Fluscape/fluscape/trunk/data/Participants_V3.csv")
parV4$Participant_ID <- apply(parV4[,1:3],1,
function(x){
sprintf("L%02dH%02dP%02d",as.numeric(x[3]),as.numeric(x[2]),as.numeric(x[1]))
})
parV1$Participant_ID <- apply(parV1[,1:3],1,
function(x){
sprintf("L%02dH%02dP%02d",as.numeric(x[3]),as.numeric(x[2]),as.numeric(x[1]))
})
parV2$Participant_ID <- apply(parV2[,1:3],1,
function(x){
sprintf("L%02dH%02dP%02d",as.numeric(x[3]),as.numeric(x[2]),as.numeric(x[1]))
})
parV3$Participant_ID <- apply(parV3[,1:3],1,
function(x){
sprintf("L%02dH%02dP%02d",as.numeric(x[3]),as.numeric(x[2]),as.numeric(x[1]))
})
parV1 <- parV1[,c("Participant_ID","PART_SAMPLE_TIME")]
parV1$Visit <- "V1"
colnames(parV1) <- c("Participant_ID","sample","Visit")
parV2 <- parV2[,c("Participant_ID","PART_SAMPLE_TIME")]
parV2$Visit <- "V2"
colnames(parV2) <- c("Participant_ID","sample","Visit")
parV3 <- parV3[,c("Participant_ID","PART_SAMPLE_TIME")]
parV3$Visit <- "V3"
colnames(parV3) <- c("Participant_ID","sample","Visit")
parV4A <- parV4[,c("Participant_ID","PART_BIRTH_YEAR","PART_BIRTH_MONTH")]
parV4B <- parV4[,c("Participant_ID","PART_SAMPLE_TIME")]
parV4B$Visit <- "V4"
colnames(parV4B) <- c("Participant_ID","sample","Visit")
dat <- merge(dat,parV4A,by="Participant_ID")
dat$birth_date <- paste0(dat$PART_BIRTH_YEAR,"-",dat$PART_BIRTH_MONTH,"-01")
dat$birth_date <- as.Date(dat$birth_date)
datV1 <- merge(dat[dat$Visit=="V1",],parV1,by=c("Participant_ID","Visit"),all = TRUE)
datV2 <- merge(dat[dat$Visit=="V2",],parV2,by=c("Participant_ID","Visit"),all=TRUE)
datV3 <- merge(dat[dat$Visit=="V3",],parV3,by=c("Participant_ID","Visit"),all = TRUE)
datV4 <- merge(dat[dat$Visit=="V4",],parV4B,by=c("Participant_ID","Visit"),all = TRUE)
dat <- rbind(datV1,datV2,datV3,datV4)
dat$sample <- as.Date(dat$sample)
dat <- dat[,c("Participant_ID","Visit","Virus","HI_Titer","birth_date","sample")]
dat[dat$Visit == "v1","Visit"] <- "V1"
dat[dat$HI_Titer == 1,"HI_Titer"] <- 10
dat[dat$HI_Titer == 0,"HI_Titer"] <- 5
head(dat)
dat[dat$HI_Titer==0,]
dat[dat$HI_Titer==0,"HI_Titer"]
dat[dat$HI_Titer==0,"HI_Titer"] <- 5
unique(dat$HI_Titer)
class(dat$HI_Titer)
dat$logTiter <- log2(dat$HI_Titer/5)
ggplot(dat[dat$Participant_ID==unique(dat$Participant_ID)[2],]) + geom_line(aes(x=sample,y=HI_Titer)) + facet_wrap(~Virus)
ggplot(dat[dat$Participant_ID==unique(dat$Participant_ID)[3],]) + geom_line(aes(x=sample,y=HI_Titer)) + facet_wrap(~Virus)
ggplot(dat[dat$Participant_ID==unique(dat$Participant_ID)[4],]) + geom_line(aes(x=sample,y=HI_Titer)) + facet_wrap(~Virus)
ggplot(dat[dat$Participant_ID==unique(dat$Participant_ID)[2],]) + geom_line(aes(x=sample,y=logTiter)) + facet_wrap(~Virus)
ggplot(dat[dat$Participant_ID==unique(dat$Participant_ID)[2],]) + geom_line(aes(x=sample,y=logTiter)) + facet_wrap(~Virus)
ggplot(dat[dat$Participant_ID==unique(dat$Participant_ID)[4],]) + geom_line(aes(x=sample,y=logTiter)) + facet_wrap(~Virus)
min(dat$sample)
max(dat$sample)
min(!is.na(dat$sample))
min(dat$sample[!is.na(dat$sample)])
max(dat$sample[!is.na(dat$sample)])
knitr::opts_chunk$set(echo = FALSE,message=FALSE,warning=FALSE)
library(plyr)
library(ggplot2)
library(knitr)
## Read in the latest titer data
dat <- read.csv("~/Documents/Fluscape/fluscape/trunk/data/HI_titers_paired.csv")
viruses <- read.csv("~/Documents/Fluscape/FluScapeOwn/H3N2_codes.csv")
## Reorder viruses with what is there
colnames(viruses)[1] <- "Virus"
dat <- merge(dat,viruses[,c("Virus","no_duplicated_codes")], by = "Virus")
colnames(dat)[1] <- "OldVirus"
colnames(dat)[15] <- "Virus"
viruses <- viruses[viruses$no_duplicated_codes %in% unique(dat$Virus),]
tmpViruses <- unique(viruses[,c("year","no_duplicated_codes")])
tmpViruses <- tmpViruses[order(tmpViruses$no_duplicated_codes),]
real_order <- order(tmpViruses$year)
dat$Virus <- factor(dat$Virus,levels(dat$Virus)[real_order])
parV4 <- read.csv("~/Documents/Fluscape/fluscape/trunk/data/Participants_V4.csv")
parV1 <- read.csv("~/Documents/Fluscape/fluscape/trunk/data/Participants_V1.csv")
parV2 <- read.csv("~/Documents/Fluscape/fluscape/trunk/data/Participants_V2.csv")
parV3 <- read.csv("~/Documents/Fluscape/fluscape/trunk/data/Participants_V3.csv")
parV4$Participant_ID <- apply(parV4[,1:3],1,
function(x){
sprintf("L%02dH%02dP%02d",as.numeric(x[3]),as.numeric(x[2]),as.numeric(x[1]))
})
parV1$Participant_ID <- apply(parV1[,1:3],1,
function(x){
sprintf("L%02dH%02dP%02d",as.numeric(x[3]),as.numeric(x[2]),as.numeric(x[1]))
})
parV2$Participant_ID <- apply(parV2[,1:3],1,
function(x){
sprintf("L%02dH%02dP%02d",as.numeric(x[3]),as.numeric(x[2]),as.numeric(x[1]))
})
parV3$Participant_ID <- apply(parV3[,1:3],1,
function(x){
sprintf("L%02dH%02dP%02d",as.numeric(x[3]),as.numeric(x[2]),as.numeric(x[1]))
})
parV1 <- parV1[,c("Participant_ID","PART_SAMPLE_TIME")]
parV1$Visit <- "V1"
colnames(parV1) <- c("Participant_ID","sample","Visit")
parV2 <- parV2[,c("Participant_ID","PART_SAMPLE_TIME")]
parV2$Visit <- "V2"
colnames(parV2) <- c("Participant_ID","sample","Visit")
parV3 <- parV3[,c("Participant_ID","PART_SAMPLE_TIME")]
parV3$Visit <- "V3"
colnames(parV3) <- c("Participant_ID","sample","Visit")
parV4A <- parV4[,c("Participant_ID","PART_BIRTH_YEAR","PART_BIRTH_MONTH")]
parV4B <- parV4[,c("Participant_ID","PART_SAMPLE_TIME")]
parV4B$Visit <- "V4"
colnames(parV4B) <- c("Participant_ID","sample","Visit")
dat <- merge(dat,parV4A,by="Participant_ID")
dat$birth_date <- paste0(dat$PART_BIRTH_YEAR,"-",dat$PART_BIRTH_MONTH,"-01")
dat$birth_date <- as.Date(dat$birth_date)
datV1 <- merge(dat[dat$Visit=="V1",],parV1,by=c("Participant_ID","Visit"),all = TRUE)
datV2 <- merge(dat[dat$Visit=="V2",],parV2,by=c("Participant_ID","Visit"),all=TRUE)
datV3 <- merge(dat[dat$Visit=="V3",],parV3,by=c("Participant_ID","Visit"),all = TRUE)
datV4 <- merge(dat[dat$Visit=="V4",],parV4B,by=c("Participant_ID","Visit"),all = TRUE)
dat <- rbind(datV1,datV2,datV3,datV4)
dat$sample <- as.Date(dat$sample)
dat <- dat[,c("Participant_ID","Visit","Virus","HI_Titer","birth_date","sample")]
####################################
## Do some data cleaning here
dat[dat$Visit == "v1","Visit"] <- "V1"
dat <- dat[dat$Visit != "20",]
dat[dat$HI_Titer == 1 & !is.na(dat$HI_Titer),"HI_Titer"] <- 10
######################################
## Convert to log scale
dat[dat$HI_Titer == 0 & !is.na(dat$HI_Titer),"HI_Titer"] <- 5
dat$logTiter <- log2(dat$HI_Titer/5)
##
minx <- min(dat$sample[!is.na(dat$sample)])
maxx <- max(dat$sample[!is.na(dat$sample)])
ggplot(dat[dat$Participant_ID==unique(dat$Participant_ID)[2],]) + geom_line(aes(x=sample,y=logTiter)) + facet_wrap(~Virus) + scale_y_continuous(limits=c(minx,maxx))
head(dat)
ggplot(dat[dat$Participant_ID==unique(dat$Participant_ID)[2],]) + geom_line(aes(x=sample,y=logTiter)) + facet_wrap(~Virus) + scale_x_continuous(limits=c(minx,maxx))
minx <- as.numeric(min(dat$sample[!is.na(dat$sample)]))
maxx <- as.numeric(max(dat$sample[!is.na(dat$sample)]))
ggplot(dat[dat$Participant_ID==unique(dat$Participant_ID)[2],]) + geom_line(aes(x=sample,y=logTiter)) + facet_wrap(~Virus) + scale_x_continuous(limits=c(minx,maxx))
minx
maxx
ggplot(dat[dat$Participant_ID==unique(dat$Participant_ID)[2],]) + geom_line(aes(x=sample,y=logTiter)) + facet_wrap(~Virus) + scale_x_datetime(limits=c(minx,maxx))
class(minx)
minx <- as.Date(min(dat$sample[!is.na(dat$sample)]),origin="2000-01-01")
maxx <- as.Date(max(dat$sample[!is.na(dat$sample)]),origin="2000-01-01")
ggplot(dat[dat$Participant_ID==unique(dat$Participant_ID)[2],]) + geom_line(aes(x=sample,y=logTiter)) + facet_wrap(~Virus) + scale_x_datetime(limits=c(minx,maxx))
ggplot(dat[dat$Participant_ID==unique(dat$Participant_ID)[2],]) + geom_line(aes(x=sample,y=logTiter)) + facet_wrap(~Virus) + scale_x_continuous(limits=c(minx,maxx))
class(minx)
minx
?scale_x_datetime
ggplot(dat[dat$Participant_ID==unique(dat$Participant_ID)[2],]) + geom_line(aes(x=sample,y=logTiter)) + facet_wrap(~Virus) + scale_x_date(limits=c(minx,maxx))
length(unique(dat$Participant_ID))
samps <- sample(3, 1:length(unique(dat$Participant_ID)))
samps
samps <- sample(1:length(unique(dat$Participant_ID)),3)
samps
indiv1 <- ggplot(dat[dat$Participant_ID==unique(dat$Participant_ID)[samps[1],]) + geom_line(aes(x=sample,y=logTiter)) + facet_wrap(~Virus) + scale_x_date(limits=c(minx,maxx))
indiv1 <- ggplot(dat[dat$Participant_ID==unique(dat$Participant_ID)[samps[1]],]) +
geom_line(aes(x=sample,y=logTiter)) + facet_wrap(~Virus) + scale_x_date(limits=c(minx,maxx))
indiv2 <- ggplot(dat[dat$Participant_ID==unique(dat$Participant_ID)[samps[2]],]) +
geom_line(aes(x=sample,y=logTiter)) + facet_wrap(~Virus) + scale_x_date(limits=c(minx,maxx))
indiv3 <- ggplot(dat[dat$Participant_ID==unique(dat$Participant_ID)[samps[3]],]) +
geom_line(aes(x=sample,y=logTiter)) + facet_wrap(~Virus) + scale_x_date(limits=c(minx,maxx))
cowplot::plot_grid(indiv1,indiv2,indiv3,ncol=1)
samps[1]
samps[2]
unique(dat$Participant_ID)[samps[1]],]
dat[dat$Participant_ID==unique(dat$Participant_ID)[samps[1]],]
unique(dat$Participant_ID)[samps[1]]
indiv1
dat[dat$Participant_ID==unique(dat$Participant_ID)[samps[1]],]
dat[dat$Participant_ID==unique(dat$Participant_ID)[samps[2]],]
dat[dat$Participant_ID==unique(dat$Participant_ID)[samps[3]],]
indiv1 <- ggplot(dat[dat$Participant_ID==unique(dat$Participant_ID)[2],]) +
geom_line(aes(x=sample,y=logTiter)) + facet_wrap(~Virus) + scale_x_date(limits=c(minx,maxx))
indiv1
indiv1 <- ggplot(dat[dat$Participant_ID==unique(dat$Participant_ID)[2],]) +
geom_line(aes(x=sample,y=logTiter)) + facet_wrap(~Virus) + scale_x_date(limits=c(minx,maxx))
indiv2 <- ggplot(dat[dat$Participant_ID==unique(dat$Participant_ID)[15],]) +
geom_line(aes(x=sample,y=logTiter)) + facet_wrap(~Virus) + scale_x_date(limits=c(minx,maxx))
indiv3 <- ggplot(dat[dat$Participant_ID==unique(dat$Participant_ID)[28],]) +
geom_line(aes(x=sample,y=logTiter)) + facet_wrap(~Virus) + scale_x_date(limits=c(minx,maxx))
cowplot::plot_grid(indiv1,indiv2,indiv3,ncol=1)
getwd()

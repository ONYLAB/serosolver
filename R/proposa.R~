infection_history_proposal_gibbs_R <- function(pars, infHist, indivSampPropn, n_years_samp, ageMask, n_alive, alpha, beta){
    n_indivs <- nrow(infHist)
    n_strains <- ncol(infHist)

    newInfHist <- infHist

    for(i in 1:n_indivs){
        if(runif(1) < indivSampPropn){
            sample_years <- seq(ageMask[i],n_strains,by=1)
            n_samp_max <- length(sample_years)
            n_samp_max <- min(n_years_samp, n_years_max)
            samps <- seq(1,n_samp_max,by=1)
            
            locs <- sample(samps, n_samp_max,replace=FALSE)

            for(j in 1:length(locs)){
                proposedIndivHist <- indivHist <- infHist[i,]
                year <- sample_years(locs[j])

                m <- sum(newInfHist[,year]) - proposedIndivHist[year]
                n <- n_alive - 1
                ratio <- (m+alpha)/(n+alpha+beta)

                rand1 <- runif(1)
                if(rand1 < ratio){
                    proposedIndivHist[year] <- 1
                } else {
                    proposedIndivHist[year] <- 0
                }

                if(proposedIndivHist[year] != indivHist[year]){
                    old_prob <- new_prob <- 1
                    log_prob <- min(0, new_prob - old_prob)
                    rand1 <- runif(1)
                    if(log(rand1) < log_prob){
                        newInfHist[i,year] <- propoesdIndivHist[year]
                    }
                }
            }
        }
    }
    return(newInfHist)
}
